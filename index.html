<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Mind - 智能思维导图</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="header">
        <div class="logo">🧠 Dream Mind</div>
        <div class="toolbar" onclick="event.stopPropagation()">
            <div class="toolbar-group">
                <button id="addNode"><i class="fas fa-plus"></i> 添加节点</button>
                <button id="addSibling"><i class="fas fa-arrow-right"></i> 同级节点</button>
                <button id="deleteNode"><i class="fas fa-trash"></i> 删除</button>
            </div>
            <div class="toolbar-group">
                <select id="layoutType">
                    <option value="radial">辐射图</option>
                    <option value="tree">树状图</option>
                    <option value="fishbone">鱼骨图</option>
                    <option value="timeline">时间轴</option>
                    <option value="org">组织架构</option>
                </select>
                <select id="nodeStyle">
                    <option value="rounded">圆角矩形</option>
                    <option value="circle">圆形</option>
                    <option value="diamond">菱形</option>
                    <option value="cloud">云朵</option>
                </select>
            </div>
            <div class="toolbar-group">
                <button id="undo"><i class="fas fa-undo"></i></button>
                <button id="redo"><i class="fas fa-redo"></i></button>
                <button id="zoomIn"><i class="fas fa-search-plus"></i></button>
                <button id="zoomOut"><i class="fas fa-search-minus"></i></button>
                <button id="fitScreen"><i class="fas fa-expand-arrows-alt"></i></button>
            </div>
            <div class="toolbar-group">
                <button id="save"><i class="fas fa-save"></i> 保存</button>
                <button id="load"><i class="fas fa-folder-open"></i> 加载</button>
                <button id="export"><i class="fas fa-download"></i> 导出</button>
                <button id="clear"><i class="fas fa-broom"></i> 清空</button>
            </div>
        </div>
    </div>

    <div class="theme-selector">
        <h4 style="margin-bottom: 10px;">主题</h4>
        <div class="theme-item active" data-theme="default" style="background: linear-gradient(45deg, #667eea, #764ba2);"></div>
        <div class="theme-item" data-theme="ocean" style="background: linear-gradient(45deg, #2196F3, #21CBF3);"></div>
        <div class="theme-item" data-theme="forest" style="background: linear-gradient(45deg, #4CAF50, #8BC34A);"></div>
        <div class="theme-item" data-theme="sunset" style="background: linear-gradient(45deg, #FF9800, #FF5722);"></div>
        <div class="theme-item" data-theme="purple" style="background: linear-gradient(45deg, #9C27B0, #E91E63);"></div>
    </div>
    
    <button class="smart-layout-btn" id="smartLayout" title="智能布局">
        <i class="fas fa-magic"></i> 智能布局
    </button>
    
    <div class="auto-save-indicator" id="autoSaveIndicator">
        <i class="fas fa-check"></i> 自动保存中...
    </div>
    
    <div class="performance-indicator" id="performanceIndicator">
        <i class="fas fa-tachometer-alt"></i> 视口优化: 开启
    </div>

    <canvas id="mindMap" class="viewport-optimized"></canvas>
    <canvas id="minimap" class="minimap"></canvas>

    <div class="floating-toolbar" onclick="event.stopPropagation()">
        <button class="floating-btn" id="floatAdd" title="快速添加"><i class="fas fa-plus"></i></button>
        <button class="floating-btn" id="floatStyle" title="样式"><i class="fas fa-palette"></i></button>
        <button class="floating-btn" id="floatConnect" title="连接"><i class="fas fa-link"></i></button>
        <button class="floating-btn" id="floatNote" title="备注"><i class="fas fa-sticky-note"></i></button>
        <button class="floating-btn" id="musicToggle" title="背景音乐"><i class="fas fa-volume-mute"></i></button>
        <button class="floating-btn" id="performanceToggle" title="性能优化"><i class="fas fa-bolt"></i></button>
        <button class="floating-btn" id="aiAssistant" title="AI助手"><i class="fas fa-robot"></i></button>
    </div>
    
    <div class="ai-panel" id="aiPanel" style="display: none;" onclick="event.stopPropagation()">
        <div class="ai-header">
            <h3><i class="fas fa-robot"></i> Dream AI 助手</h3>
            <button class="ai-close" onclick="mindMap.toggleAI()">&times;</button>
        </div>
        <div class="ai-content">
            <div class="ai-suggestions">
                <button onclick="event.stopPropagation(); mindMap.aiGenerate('expand')">扩展思路</button>
                <button onclick="event.stopPropagation(); mindMap.aiGenerate('organize')">整理结构</button>
                <button onclick="event.stopPropagation(); mindMap.aiGenerate('brainstorm')">头脑风暴</button>
            </div>
            <div class="ai-chat">
                <div id="aiMessages"></div>
                <div>
                    <input type="text" id="aiInput" placeholder="问AI任何关于思维导图的问题..." onkeypress="if(event.key==='Enter')mindMap.sendAI()">
                    <button onclick="event.stopPropagation(); mindMap.sendAI()">发送</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="music-panel" id="musicPanel" style="display: none; position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); z-index: 600; min-width: 200px;">
        <h4 style="margin-bottom: 10px; color: #333;">背景音乐</h4>
        <select id="musicSelect" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; background: white;">
            <option value="none">无</option>
            <option value="focus">专注模式</option>
            <option value="creative">创意模式</option>
            <option value="calm">宁静模式</option>
        </select>
        <input type="file" id="customMusic" accept="audio/*" style="margin-top: 10px; width: 100%;">
    </div>

    <div class="export-modal" id="exportModal">
        <div class="export-content">
            <h3>导出思维导图</h3>
            <div class="export-options">
                <div class="export-btn" data-format="png"><i class="fas fa-image"></i><br>PNG图片</div>
                <div class="export-btn" data-format="jpg"><i class="fas fa-file-image"></i><br>JPG图片</div>
                <div class="export-btn" data-format="svg"><i class="fas fa-vector-square"></i><br>SVG矢量</div>
                <div class="export-btn" data-format="pdf"><i class="fas fa-file-pdf"></i><br>PDF文档</div>
                <div class="export-btn" data-format="json"><i class="fas fa-code"></i><br>JSON数据</div>
                <div class="export-btn" data-format="txt"><i class="fas fa-file-alt"></i><br>文本大纲</div>
            </div>
            <button onclick="closeExportModal()" style="margin-top: 20px; width: 100%; padding: 10px; background: #ccc; border: none; border-radius: 5px;">取消</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="mindmap.js"></script>
</body>
</html>